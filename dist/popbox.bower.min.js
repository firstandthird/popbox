/*!
 * popbox - Tooltip/Popover Library
 * v0.11.0
 * https://github.com/firstandthird/popbox
 * copyright First + Third 2014
 * MIT License
*/
!function(a){a.declare("popbox",{defaults:{containerClass:"popbox",direction:"smart",directionClasses:"left left-edge up right right-edge down left-up right-up",directionOffset:10,animOffset:5,hideTimeout:100,enableHover:!0,clickToShow:!0},init:function(){this.open=!1,this.hoveringOverTooltip=!1,this.hideTimer=null,this.text=this.el.data("popbox-text")||"",this.title=this.el.data("popbox-title")||"",this.templateEl=this.el.data("popbox-el")||"",this.direction=this.el.data("popbox-direction")||this.direction,this.template="",this.attachEvents()},isOpen:function(){return this.open},attachEvents:function(){this.enableHover&&(this.el.bind("mouseenter.popbox",this.proxy(this.show)),this.el.bind("mouseleave.popbox",this.proxy(this.hide)))},reset:function(){this.template&&(this.template.unbind(".popbox"),this.template.remove())},show:function(b){this.hoveringOverTooltip||this.text&&("undefined"!=typeof b&&this.forcedOpen||("undefined"==typeof b&&(this.forcedOpen=!0),clearTimeout(this.hideTimer),this.open||(a("body").append(this.generateTemplate()),this.template.bind("mouseenter.popbox",this.proxy(this.hoverTooltip)),this.template.bind("mouseleave.popbox",this.proxy(this.hoverLeaveTooltip)),this.template.bind("click.popbox",this.proxy(this.popboxClick)),this.position(),this.template.addClass("open")),this.open=!0,this.el.trigger("show")))},hide:function(a){this.hoveringOverTooltip||this.open&&("undefined"!=typeof a&&this.forcedOpen||("undefined"==typeof a&&(this.forcedOpen=!1),this.hideTimer=setTimeout(this.proxy(function(){var a="webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend";this.template.removeClass("open"),this.template.bind(a,this.proxy(function(){this.template.unbind(a),this.reset(),this.el.trigger("hide")})),this.open=!1,this.hoveringOverTooltip=!1}),this.hideTimeout)))},toggle:function(a){return this.clickToShow?(this.open?this.hide(a):this.show(a),!1):void 0},position:function(){this.template.css({position:"absolute"}),this.template.removeClass(this.directionClasses);var b,c,d=this.el.offset(),e="auto",f=this.direction,g=!1,h=0,i=["down","up","left","right","left-up","right-up","down"];for("smart"===this.direction&&(f=i[0]);!g;){switch(h++,f){case"left":b=d.left-this.template.outerWidth()-this.directionOffset-this.animOffset,c=d.top+this.el.outerHeight()/2-this.template.outerHeight()/2,this.template.addClass("left");break;case"up":b=d.left+this.el.outerWidth()/2-this.template.outerWidth()/2,c=d.top-this.template.outerHeight()-this.directionOffset-this.animOffset,this.template.addClass("up");break;case"right":b=d.left+this.el.outerWidth()+this.directionOffset+this.animOffset,c=d.top+this.el.outerHeight()/2-this.template.outerHeight()/2,this.template.addClass("right");break;case"down":b=d.left+this.el.outerWidth()/2-this.template.outerWidth()/2,c=d.top+this.el.outerHeight()+this.directionOffset+this.animOffset,this.template.addClass("down");break;case"left-up":b=d.left-this.template.outerWidth()/2,c=d.top-this.template.outerHeight()-this.directionOffset-this.animOffset,this.template.addClass("left-up");break;case"right-up":b=d.left+this.el.outerWidth()-this.template.outerWidth()/2,c=d.top-this.template.outerHeight()-this.directionOffset-this.animOffset,this.template.addClass("right-up")}"smart"===this.direction?(this.template.css({left:b,right:e,top:c}),this.isInViewport(this.template)||h===i.length?g=!0:(f=i[h],this.template.removeClass(this.directionClasses))):g=!0}a(window).width()-(b+this.template.outerWidth())<0?(this.template.addClass("right-edge"),b="auto",e=0):0>b&&(this.template.addClass("left-edge"),b=0),this.template.css({left:b,right:e,top:c})},generateTemplate:function(){if(this.template)return this.template;var b=a(document.createElement("div")),c=a(document.createElement("div")),d=a(document.createElement("div"));return b.addClass(this.containerClass),this.templateEl?b.append(a(this.templateEl).html()):(this.title&&(c.addClass("title"),c.html(this.title),b.append(c)),this.text&&(d.addClass("text"),d.html(this.text),b.append(d))),this.template=b,this.template},hoverTooltip:function(){clearTimeout(this.hideTimer),this.hoveringOverTooltip=!0},hoverLeaveTooltip:function(){this.hoveringOverTooltip=!1,this.el.trigger("mouseleave.popbox")},setText:function(a){this.text=a,this.open&&this.template.find(".text").text(a)},popboxClick:function(){this.emit("popboxClick")},destroy:function(){this.reset(),this.el.unbind(".popbox"),Fidel.prototype.destroy.call(this)},isInViewport:function(b){var c=b[0].getBoundingClientRect();return c.top>=0&&c.left>=0&&c.bottom<=a(window).height()&&c.right<=a(window).width()}}),a.popboxDisableAutoAPI||a("[data-popbox]").popbox()}(jQuery);